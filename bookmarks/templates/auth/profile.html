{% extends 'base.html' %}

{% block title %}User {{user.username}}{% endblock title %}
{% block meta %}{% if g.user.is_authenticated and user != g.user %}<meta name="csrf-token" content="{{ csrf_token() }}">{% endif %}{% endblock meta %}

{% block content %}
<div class="row">
    <div class="col s6 push-s3">
    {% if g.user.is_authenticated %}
        {% if user != g.user %}
        <div class="switch">
            <label>Subscribed
                <input id="subscriptionCheckbox" {% if user in g.user.subscribed.all() %}checked{% endif %} type="checkbox" data-user-id={{user.id}} data-user-username={{user.username}}>
                <span class="lever"></span>
            </label>
        </div>
        {% else %}
        <div class="row">
            <div class="col s12">
                <ul class="tabs tabs-fixed-width z-depth-1">
                    <li class="tab col s3"><a class="active" href="#profile-tab">Profile</a></li>
                    <li class="tab col s3"><a href="#password-tab">Password</a></li>
                </ul>
            </div>

            <div id="profile-tab" class="col s12">
                <form method="POST" action="{{url_for('users.update_profile', id=user.id)}}">
                    {{ profile_form.csrf_token(id="csrfProfileUpdate") }}
                    <div class="input-field col s12">
                        {% for error in profile_form.username.errors %}<span class="right red-text">{{error}}</span>{% endfor %}
                        <input id={{profile_form.username.id}} type="text" name={{profile_form.username.name}} value={{profile_form.username.data}}>
                        <label for={{profile_form.username.id}} data-error="wrong" data-success="correct">{{profile_form.username.label.text}}</label>
                    </div>
                    <div class="input-field col s12">
                        {% for error in profile_form.email.errors %}<span class="right red-text">{{error}}</span>{% endfor %}
                        <input id={{profile_form.email.id}} type="email" name={{profile_form.email.name}} value={{profile_form.email.data}}>
                        <label for={{profile_form.email.id}} data-error="wrong" data-success="correct">{{profile_form.email.label.text}}</label>
                    </div>
                    <div class="col s12 input-field" align="center" style="padding-bottom:20px; margin-top:0px;">{{recaptcha}}</div>
                    <div class="center-align">
                        <button class="btn waves-effect waves-light" type="submit" name="action">update</button>
                    </div>
                </form>
            </div>

            <div id="password-tab" class="col s12">
                <form method="POST" action="{{url_for('users.update_password', id=user.id)}}">
                    {{ password_form.csrf_token(id="csrfPasswordUpdate") }}
                    <div class="input-field col s12">
                        {% for error in password_form.password.errors %}
                            <span class="right red-text">{{error}}</span>
                        {% endfor %}
                        <input id={{password_form.password.id}} type="password" name={{password_form.password.name}} Placeholder="You must provide your current password in order to change it.">
                        <label for={{password_form.password.id}} data-error="wrong" data-success="correct">{{password_form.password.label.text}}</label>
                    </div>
                    <div class="input-field col s12">
                        {% for error in password_form.new_password.errors %}
                            <span class="right red-text">{{error}}</span>
                        {% endfor %}
                        <input id={{password_form.new_password.id}} type="password" class="validate" name={{password_form.new_password.name}}>
                        <label for={{password_form.new_password.id}} data-error="wrong" data-success="correct">{{password_form.new_password.label.text}}</label>
                    </div>
                    <div class="input-field col s12">
                        {% for error in password_form.confirm_password.errors %}
                            <span class="right red-text">{{error}}</span>
                        {% endfor %}
                        <input id={{password_form.confirm_password.id}} type="password" class="validate" name={{password_form.confirm_password.name}}>
                        <label for={{password_form.confirm_password.id}} data-error="wrong" data-success="correct">{{password_form.confirm_password.label.text}}</label>
                    </div>
                    <div class="col s12 input-field" align="center" style="padding-bottom:20px; margin-top:0px;">{{recaptcha}}</div>
                    <div class="center-align">
                        <button class="btn waves-effect waves-light" type="submit" name="action">change password</button>
                    </div>
                </form>
            </div>

        </div>
        {% endif %}
    {% endif %}
{% endblock content %}


{% block scripts %}
{% if g.user.is_authenticated and user != g.user %}
    <script type="text/javascript" src="{{ url_for('static', filename='/js/subscriptions.js')}}"></script>
{% endif %}
<script type="text/javascript" src="{{ url_for('static', filename='/js/profile.js')}}"></script>
{% endblock scripts %}
