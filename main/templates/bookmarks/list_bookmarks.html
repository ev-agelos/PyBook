{% extends 'base.html' %}

{% block title %}Bookmarks{% endblock title %}

{% block content %}
    
{% set orders = ['new', 'oldest', 'top', 'unpopular'] %}
{% set active_page = request.args.order_by|default('new') %}



<div class="container">
    <div class="row">
        <nav class="navbar navbar-default col-md-6 col-md-offset-2">
            <div class="container-fluid">
                <div class="collapse navbar-collapse">
                    <ul class="nav navbar-nav">
                        {% for order in orders %}
                            <li class="{% if order == active_page %}active{% endif %}">
                                <a href={{ url_for(request.endpoint, order_by=order, **request.view_args)}}>{{order}}</a>
                            </li>
                        {% endfor %}
                    </ul>
                    <p class="navbar-text navbar-right">Category:<strong> {{category_name}}</strong></p>
                </div> 
            </div>
        </nav>
    </div>
    <br>
    <div class="row">
        <div class="col-md-12">
            {% for bookmark in paginator.items %}
                <div class="row" id={{loop.index}}>
                    <div class="col-md-1 text-center" style="vertical-align:middle">
                        <p>{{(loop.index + (paginator.prev_num * paginator.per_page))}}</p>
                    </div>

                    <div id="votes" class="col-md-1">
                        <div class='row text-center'>
                            {% if g.user.is_authenticated %}
                                {% set up_vote_color = ''%}
                                {% if bookmark.vote and bookmark.vote.direction == True %} {% set up_vote_color = 'rgb(255, 102, 0)' %} {% endif %}
                                <a class="btn-sm {{up_vote_color}}" href="#" id="up_vote{{loop.index}}" onClick="vote({{loop.index}}, '{{bookmark.title}}', 1)"><span class="glyphicon glyphicon-chevron-up" style="color:{{up_vote_color}}"></span></a>
                            {% else %}
                                <a class="btn-sm" href="#unauthenticated_vote" data-toggle="modal"><span class="glyphicon glyphicon-chevron-up"></span></a>
                            {% endif %}
                        </div>

                        <div id="total_vote_{{loop.index}}" class='row text-center'>
                            <strong>{{bookmark.rating}}</strong>
                        </div>

                        <div class='row text-center'>
                            {% if g.user.is_authenticated %}
                                {% set down_vote_color = ''%}
                                {% if bookmark.vote and bookmark.vote.direction == False %} {% set down_vote_color = 'rgb(255, 102, 0)' %} {% endif %}
                                <a class="btn-sm" href="#" id="down_vote{{loop.index}}" onClick="vote({{loop.index}}, '{{bookmark.title}}', -1)"><span class="glyphicon glyphicon-chevron-down" style="color:{{down_vote_color}}"></span></a>
                            {% else %}
                                <a class="btn-sm" href="#unauthenticated_vote" data-toggle="modal"><span class="glyphicon glyphicon-chevron-down"></span></a>
                            {% endif %}
                        </div>
                    </div>

                    <div id="thumbnail" class="col-md-1">
                        <img src={{url_for('static', filename='/img/' + bookmark.thumbnail)}} alt="thumbnail" class="img-rounded img-responsive center-block" style='display-inline:block'>
                    </div>

                    <div id="title" class="col-md-7">
                        <div class='row'>
                            <a href={{bookmark.url}} target="_blank" class='text-info'>
                                {{bookmark.title}}
                            </a>
                        </div>
                        <div class='row text-muted'>
                            <small>submitted {{bookmark.get_human_time()}} by 
                                <a href={{url_for('users.get_user', username=bookmark.user.username)}} target='_blank' class='text-primary'>
                                    {{bookmark.user.username}}
                                </a>
                            </small>
                        </div>
                        <div class='row'>
                            <ul class='list-inline'>
                                {% if g.user.is_authenticated %}
                                    {% if bookmark.user_id == g.user._id %}
                                        <li>
                                            <a href={{ url_for('crud.update_bookmark', title=bookmark.title) }} class='text-muted'>
                                                <small>edit</small>
                                            </a>
                                        </li>
                                    {% endif %}

                                    {% if bookmark.saved and bookmark.saved.is_saved %}
                                        <li>
                                            <a id="save" href="#" onClick="save({{loop.index}}, {{bookmark._id}});return false;" class='text-muted'>
                                                <small>unsave</small>
                                            </a>
                                        </li>
                                    {% else %}
                                        <li>
                                            <a id="save" href="#" onClick="save({{loop.index}}, {{bookmark._id}});return false;" class='text-muted'>
                                                <small>save</small>
                                            </a>
                                        </li>
                                    {% endif %}

                                    {% if bookmark.user_id == g.user._id %}
                                        <li>
                                            <a id="delete" href="#deleteCollapse{{loop.index}}" class='text-muted' data-toggle="collapse" aria-expanded="false">
                                                <small>delete</small>
                                            </a>
                                        </li>
                                        <div class="collapse" id="deleteCollapse{{loop.index}}">
                                            <form action="{{url_for('BookmarksView:delete', bookmark_id=bookmark._id)}}" method="POST">
                                                <label>Are you sure?</label>
                                                <input type=hidden name=_csrf_token value="{{ csrf_token() }}">
                                                <button type="button" class="btn btn-default btn-xs" data-toggle="collapse" data-target="#deleteCollapse{{loop.index}}">Cancel</button>
                                                <button type="submit" class="btn btn-primary btn-xs btn-danger">Delete</button>
                                            </form>
                                        </div>
                                    {% endif %}

                                {% endif %}
                            </ul>
                        </div>
                    </div>
                </div>
                <br>
            {% endfor %}
        </div>
    </div>
</div>

<nav>
    <div class='container col-md-offset-4'>
        <ul class="pagination">
            {% if paginator.has_prev %}
                <li><a href="{{url_for(request.endpoint, page=paginator.prev_num, **request.view_args)}}">‹ prev</a></li>
            {% else %}
                <li class="disabled"><a href="#">‹ prev</a></li>
            {% endif %}

            {% if paginator.has_next %}
                <li><a href="{{url_for(request.endpoint, page=paginator.next_num, **request.view_args)}}">next ›</a></li>
            {% else %}
                <li class="disabled"><a href="#">next ›</a></li>
            {% endif %}
        </ul>
    </div>
</nav>

<div id="unauthenticated_vote" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="mySmallModalLabel">
    <div class="modal-dialog modal-sm">
        <div class="modal-content">
            <div class="modal-body"><p>You need to be logged in to vote.</p></div>
            <div class="modal-footer"><button type="button" class="btn btn-default btn-sm" data-dismiss="modal">Ok</button></div>
        </div>
    </div>
</div>

<script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
<script type="text/javascript">var csrftoken = "{{ csrf_token() }}"</script>
<script type="text/javascript" src="{{ url_for('static', filename='/js/my_script.js')}}"></script>
<script type="text/javascript" src="{{ url_for('static', filename='/js/save_bookmark.js')}}"></script>

{% endblock content %}
